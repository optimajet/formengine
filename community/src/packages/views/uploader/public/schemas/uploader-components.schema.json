{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "version": {
      "$ref": "#/definitions/PersistedFormVersion",
      "description": "The version of the saved form."
    },
    "actions": {
      "$ref": "#/definitions/ActionValues",
      "description": "Represents a set of action definitions."
    },
    "formValidator": {
      "type": "string",
      "description": "The form validator."
    },
    "errorProps": {
      "description": "Properties of the component displaying the error."
    },
    "modalType": {
      "type": "string",
      "description": "Name of the type of component that displays the modal."
    },
    "tooltipType": {
      "type": "string",
      "description": "Name of the type of component that displays the tooltip."
    },
    "errorType": {
      "type": "string",
      "description": "Name of the type of component displaying the error.",
      "enum": [
        "DefaultErrorMessage"
      ]
    },
    "form": {
      "$ref": "#/definitions/ScreenComponentStore",
      "description": "Settings for components that display the form."
    },
    "localization": {
      "$ref": "#/definitions/LocalizationValue",
      "description": "Localization of the form."
    },
    "languages": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Language"
      },
      "description": "Form languages."
    },
    "defaultLanguage": {
      "type": "string",
      "description": "The default form language."
    }
  },
  "required": [
    "form",
    "localization",
    "languages",
    "defaultLanguage"
  ],
  "description": "The scheme describes the JSON structure and the set of components used",
  "definitions": {
    "PersistedFormVersion": {
      "type": "string",
      "const": "1",
      "description": "The version of the saved form."
    },
    "ActionValues": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/PersistedActionDefinition"
      },
      "description": "Represents a set of action definitions."
    },
    "ActionParameters": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ParameterType"
      },
      "propertyNames": {
        "description": "The type for the parameter name."
      },
      "description": "Represents a set of action parameters."
    },
    "ParameterType": {
      "type": "string",
      "enum": [
        "string",
        "number",
        "boolean",
        "function"
      ],
      "description": "Parameter type."
    },
    "ComponentProperty": {
      "type": "object",
      "properties": {
        "value": {
          "description": "The simple value of a component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a component property."
        },
        "computeType": {
          "$ref": "#/definitions/ComponentPropertyComputeType",
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        },
        "editorType": {
          "type": "string",
          "description": "The component property editor type, only used in Designer mode."
        }
      },
      "description": "The value of the component property."
    },
    "ComponentPropertyComputeType": {
      "type": "string",
      "enum": [
        "function",
        "localization"
      ],
      "description": "The component property value type."
    },
    "Css": {
      "type": "object",
      "properties": {
        "any": {
          "$ref": "#/definitions/DeviceStyle",
          "description": "CSS styles for arbitrary device."
        },
        "mobile": {
          "$ref": "#/definitions/DeviceStyle",
          "description": "CSS styles for mobile devices."
        },
        "tablet": {
          "$ref": "#/definitions/DeviceStyle",
          "description": "CSS styles for tablet devices."
        },
        "desktop": {
          "$ref": "#/definitions/DeviceStyle",
          "description": "CSS styles for desktop devices."
        }
      },
      "description": "The type for the CSS property of a React component."
    },
    "DeviceStyle": {
      "type": "object",
      "properties": {
        "object": {
          "description": "CSS styles defined in the general style settings."
        },
        "string": {
          "type": "string",
          "description": "CSS styles defined in the style code editor."
        }
      },
      "description": "CSS styles for a device."
    },
    "ComponentStyle": {
      "type": "object",
      "properties": {
        "any": {
          "$ref": "#/definitions/ComponentDeviceStyle",
          "description": "Styles for an arbitrary device."
        },
        "mobile": {
          "$ref": "#/definitions/ComponentDeviceStyle",
          "description": "Styles for mobile devices."
        },
        "tablet": {
          "$ref": "#/definitions/ComponentDeviceStyle",
          "description": "Styles for tablet devices."
        },
        "desktop": {
          "$ref": "#/definitions/ComponentDeviceStyle",
          "description": "Styles for desktop devices."
        }
      },
      "description": "The type for the style property of a React component."
    },
    "ComponentDeviceStyle": {
      "type": "object",
      "properties": {
        "string": {
          "type": "string",
          "description": "The CSS string."
        }
      },
      "description": "Styles for a device."
    },
    "ActionData": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "The action name."
        },
        "type": {
          "$ref": "#/definitions/ActionType",
          "description": "The action type."
        },
        "args": {
          "$ref": "#/definitions/Arguments",
          "description": "The action arguments."
        }
      },
      "required": [
        "name",
        "type"
      ],
      "description": "Action Storage. Used for add a new action, store information about it."
    },
    "ActionType": {
      "type": "string",
      "enum": [
        "common",
        "code",
        "custom"
      ],
      "description": "Action type."
    },
    "Arguments": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ArgumentValue"
      },
      "propertyNames": {
        "description": "The type for the parameter name."
      },
      "description": "It will be transformed in arguments before passing in action."
    },
    "ArgumentValue": {
      "anyOf": [
        {
          "$ref": "#/definitions/PrimitiveArgumentValue"
        },
        {
          "$ref": "#/definitions/FunctionArgumentValue"
        }
      ],
      "description": "The type of the argument value of the function."
    },
    "PrimitiveArgumentValue": {
      "type": [
        "string",
        "number",
        "boolean"
      ],
      "description": "Primitive argument value type."
    },
    "FunctionArgumentValue": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "const": "fn",
          "description": "Argument type for function type."
        },
        "body": {
          "type": "string",
          "description": "The source code of the function for use in design mode."
        }
      },
      "required": [
        "type"
      ],
      "description": "Function argument value type."
    },
    "BoundValueSchema": {
      "type": "object",
      "properties": {
        "autoValidate": {
          "type": "boolean",
          "description": "Flag, if true then automatic validation of the value works, false otherwise."
        },
        "validations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ValidationRuleSettings"
          },
          "description": "The array of validation rule settings."
        }
      },
      "description": "Value validation rules."
    },
    "ValidationRuleSettings": {
      "type": "object",
      "properties": {
        "key": {
          "type": "string",
          "description": "The unique key of the validation rule. The key is unique within the value type."
        },
        "type": {
          "$ref": "#/definitions/ValidatorType",
          "description": "The type of validator."
        },
        "args": {
          "type": "object",
          "description": "Arguments of the validation rule."
        },
        "validateWhen": {
          "$ref": "#/definitions/ComponentProperty",
          "description": "The property that determines when validation needs to be performed."
        }
      },
      "required": [
        "key"
      ],
      "description": "The validation rule settings."
    },
    "ValidatorType": {
      "type": "string",
      "enum": [
        "internal",
        "custom"
      ],
      "description": "The type of validator."
    },
    "HtmlAttribute": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "description": "The arbitrary HTML attributes for the component."
    },
    "ModalComponentStore": {
      "allOf": [
        {
          "$ref": "#/definitions/AbstractComponentStore"
        },
        {
          "properties": {
            "type": {
              "type": "string",
              "const": "Modal",
              "description": "The component type"
            },
            "props": {
              "type": "object",
              "description": "The Modal component properties.",
              "required": [
                "modalTemplate"
              ],
              "properties": {
                "modalTemplate": {
                  "type": "object",
                  "$ref": "#/definitions/stringPropertyCalculableLocalizable"
                },
                "additionalProperties": false
              }
            }
          },
          "required": [
            "type",
            "props"
          ]
        }
      ]
    },
    "LocalizationValue": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ComponentsLocalization"
      },
      "propertyNames": {
        "description": "The full language code, e.g. 'en-US'."
      },
      "description": "The format in which localization is stored."
    },
    "ComponentsLocalization": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/TypedLocalization"
      },
      "propertyNames": {
        "description": "The component key."
      },
      "description": "A record containing localizations grouped by component key."
    },
    "TypedLocalization": {
      "type": "object",
      "properties": {
        "component": {
          "$ref": "#/definitions/ComponentPropsLocalization"
        },
        "tooltip": {
          "$ref": "#/definitions/ComponentPropsLocalization"
        },
        "modal": {
          "$ref": "#/definitions/ComponentPropsLocalization"
        }
      },
      "additionalProperties": {
        "$ref": "#/definitions/ComponentPropsLocalization"
      },
      "description": "A record containing localizations grouped by localization type."
    },
    "ComponentPropsLocalization": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "propertyNames": {
        "description": "The component property name."
      },
      "description": "A record containing localizations for the component properties."
    },
    "Language": {
      "type": "object",
      "properties": {
        "code": {
          "type": "string",
          "description": "the language code, for example, 'en'."
        },
        "dialect": {
          "type": "string",
          "description": "the dialect code, for example, 'US'."
        },
        "name": {
          "type": "string",
          "description": "the name of the language, for example 'English'."
        },
        "description": {
          "type": "string",
          "description": "the description of the language, for example 'American English'."
        },
        "bidi": {
          "$ref": "#/definitions/BiDi",
          "description": "the type of text layout, for example, BiDi.LTR."
        }
      },
      "required": [
        "code",
        "dialect",
        "name",
        "description",
        "bidi"
      ],
      "description": "The language to localize the form builder."
    },
    "BiDi": {
      "type": "string",
      "enum": [
        "ltr",
        "rtl"
      ],
      "description": "The enumeration of bidirectional text layout types."
    },
    "PersistedActionDefinition": {
      "type": "object",
      "description": "The definition of an action.",
      "properties": {
        "body": {
          "type": "string",
          "description": "The source code of the Action."
        },
        "params": {
          "$ref": "#/definitions/ActionParameters",
          "description": "The parameters of the Action."
        }
      },
      "required": [
        "params"
      ]
    },
    "UploaderComponentStore": {
      "allOf": [
        {
          "$ref": "#/definitions/AbstractComponentStore"
        },
        {
          "description": "File upload component with drag and drop support",
          "properties": {
            "type": {
              "type": "string",
              "const": "Uploader",
              "description": "The component type"
            },
            "props": {
              "type": "object",
              "description": "The Uploader component properties.",
              "properties": {
                "action": {
                  "type": "object",
                  "$ref": "#/definitions/stringPropertyCalculableLocalizable",
                  "description": "URL to upload files to"
                },
                "value": {
                  "type": "object",
                  "$ref": "#/definitions/arrayPropertyCalculable"
                },
                "children": {
                  "type": "object",
                  "$ref": "#/definitions/undefinedPropertyCalculable",
                  "description": "Content to display inside the uploader"
                },
                "accept": {
                  "type": "object",
                  "$ref": "#/definitions/objectPropertyCalculable",
                  "description": "Accepted file types (e.g., image/*, .pdf, .docx)"
                },
                "dropzone": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable",
                  "description": "If true, the dropzone will show"
                },
                "multiple": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable",
                  "description": "Allow multiple file selection"
                },
                "disabled": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable",
                  "description": "If true, the children are in disabled state"
                },
                "readOnly": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable",
                  "description": "If true, the children are in read-only state"
                },
                "additionalProperties": false
              }
            },
            "children": {
              "$ref": "#/definitions/childrenProperty",
              "description": "The array of child components."
            }
          },
          "required": [
            "type"
          ]
        }
      ]
    },
    "SlotComponentStore": {
      "allOf": [
        {
          "$ref": "#/definitions/AbstractComponentStore"
        },
        {
          "properties": {
            "type": {
              "type": "string",
              "const": "Slot",
              "description": "The component type"
            },
            "props": {
              "type": "object",
              "description": "The Slot component properties.",
              "properties": {
                "additionalProperties": false
              }
            }
          },
          "required": [
            "type"
          ]
        }
      ]
    },
    "EmbeddedFormComponentStore": {
      "allOf": [
        {
          "$ref": "#/definitions/AbstractComponentStore"
        },
        {
          "properties": {
            "type": {
              "type": "string",
              "const": "EmbeddedForm",
              "description": "The component type"
            },
            "props": {
              "type": "object",
              "description": "The EmbeddedForm component properties.",
              "properties": {
                "storeDataInParentForm": {
                  "type": "object",
                  "$ref": "#/definitions/booleanProperty"
                },
                "formName": {
                  "type": "object",
                  "$ref": "#/definitions/stringPropertyCalculableLocalizable"
                },
                "options": {
                  "type": "object",
                  "$ref": "#/definitions/objectPropertyCalculable"
                },
                "disabled": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable"
                },
                "readOnly": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable"
                },
                "additionalProperties": false
              }
            }
          },
          "required": [
            "type"
          ]
        }
      ]
    },
    "RepeaterComponentStore": {
      "allOf": [
        {
          "$ref": "#/definitions/AbstractComponentStore"
        },
        {
          "properties": {
            "type": {
              "type": "string",
              "const": "Repeater",
              "description": "The component type"
            },
            "props": {
              "type": "object",
              "description": "The Repeater component properties.",
              "properties": {
                "itemRenderWhen": {
                  "type": "object",
                  "$ref": "#/definitions/stringPropertyCalculable"
                },
                "value": {
                  "type": "object",
                  "$ref": "#/definitions/arrayPropertyCalculable"
                },
                "children": {
                  "type": "object",
                  "$ref": "#/definitions/undefinedPropertyCalculable"
                },
                "additionalProperties": false
              }
            },
            "children": {
              "$ref": "#/definitions/childrenProperty",
              "description": "The array of child components."
            }
          },
          "required": [
            "type"
          ]
        }
      ]
    },
    "ScreenComponentStore": {
      "allOf": [
        {
          "$ref": "#/definitions/AbstractComponentStore"
        },
        {
          "properties": {
            "type": {
              "type": "string",
              "const": "Screen",
              "description": "The component type"
            },
            "props": {
              "type": "object",
              "description": "The Screen component properties.",
              "properties": {
                "children": {
                  "type": "object",
                  "$ref": "#/definitions/undefinedPropertyCalculable"
                },
                "disabled": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable"
                },
                "readOnly": {
                  "type": "object",
                  "$ref": "#/definitions/booleanPropertyCalculable"
                },
                "additionalProperties": false
              }
            },
            "children": {
              "$ref": "#/definitions/childrenProperty",
              "description": "The array of child components."
            }
          },
          "required": [
            "type"
          ]
        }
      ]
    },
    "AbstractComponentStore": {
      "type": "object",
      "properties": {
        "key": {
          "type": "string",
          "description": "The React component key"
        },
        "dataKey": {
          "type": "string",
          "description": "The component data key."
        },
        "css": {
          "$ref": "#/definitions/Css",
          "description": "The component CSS styles."
        },
        "wrapperCss": {
          "$ref": "#/definitions/Css",
          "description": "The component wrapper CSS styles."
        },
        "style": {
          "$ref": "#/definitions/ComponentStyle",
          "description": "The component styles for the `style` attribute."
        },
        "wrapperStyle": {
          "$ref": "#/definitions/ComponentStyle",
          "description": "The component wrapper styles for the `style` attribute."
        },
        "events": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/ActionData"
            }
          },
          "propertyNames": {
            "description": "The type for the event name."
          },
          "description": "The set of event handlers."
        },
        "schema": {
          "$ref": "#/definitions/BoundValueSchema",
          "description": "The component value validation settings."
        },
        "htmlAttributes": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/HtmlAttribute"
          },
          "description": "The set of arbitrary HTML attributes added to the component."
        },
        "tooltipProps": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/ComponentProperty"
          },
          "description": "The tooltip settings."
        },
        "modal": {
          "$ref": "#/definitions/ModalComponentStore",
          "description": "The modal settings."
        },
        "slot": {
          "type": "string",
          "description": "The name of the occupied component property in the parent component."
        },
        "renderWhen": {
          "$ref": "#/definitions/ComponentProperty",
          "description": "The expression or function to conditionally render a component."
        },
        "disableDataBinding": {
          "$ref": "#/definitions/ComponentProperty",
          "description": "Disables data binding for the component."
        }
      },
      "required": [
        "key"
      ],
      "description": "Component settings for serialization in JSON."
    },
    "stringPropertyCalculableLocalizable": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string",
          "description": "The simple value of a 'string' component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a 'action' component property."
        },
        "computeType": {
          "type": "string",
          "enum": [
            "localization",
            "function"
          ],
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        }
      },
      "description": "string property type, calculable, localizable",
      "allOf": [
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "function"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "required": [
              "fnSource"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "localization"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "not": {
              "required": [
                "value",
                "fnSource"
              ]
            }
          }
        },
        {
          "if": {
            "not": {
              "required": [
                "computeType"
              ]
            }
          },
          "then": {
            "required": [
              "value"
            ]
          }
        }
      ]
    },
    "arrayPropertyCalculable": {
      "type": "object",
      "properties": {
        "value": {
          "type": "array",
          "description": "The simple value of a 'array' component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a 'value' component property."
        },
        "computeType": {
          "type": "string",
          "enum": [
            "function"
          ],
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        }
      },
      "description": "array property type, calculable",
      "allOf": [
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "function"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "required": [
              "fnSource"
            ]
          }
        },
        {
          "if": {
            "not": {
              "required": [
                "computeType"
              ]
            }
          },
          "then": {
            "required": [
              "value"
            ]
          }
        }
      ]
    },
    "undefinedPropertyCalculable": {
      "type": "object",
      "properties": {
        "value": {
          "description": "The simple value of a 'undefined' component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a 'children' component property."
        },
        "computeType": {
          "type": "string",
          "enum": [
            "function"
          ],
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        }
      },
      "description": "undefined property type, calculable",
      "allOf": [
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "function"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "required": [
              "fnSource"
            ]
          }
        },
        {
          "if": {
            "not": {
              "required": [
                "computeType"
              ]
            }
          },
          "then": {
            "required": [
              "value"
            ]
          }
        }
      ]
    },
    "objectPropertyCalculable": {
      "type": "object",
      "properties": {
        "value": {
          "type": "object",
          "description": "The simple value of a 'object' component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a 'accept' component property."
        },
        "computeType": {
          "type": "string",
          "enum": [
            "function"
          ],
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        }
      },
      "description": "object property type, calculable",
      "allOf": [
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "function"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "required": [
              "fnSource"
            ]
          }
        },
        {
          "if": {
            "not": {
              "required": [
                "computeType"
              ]
            }
          },
          "then": {
            "required": [
              "value"
            ]
          }
        }
      ]
    },
    "booleanPropertyCalculable": {
      "type": "object",
      "properties": {
        "value": {
          "type": "boolean",
          "description": "The simple value of a 'boolean' component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a 'dropzone' component property."
        },
        "computeType": {
          "type": "string",
          "enum": [
            "function"
          ],
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        }
      },
      "description": "boolean property type, calculable",
      "allOf": [
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "function"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "required": [
              "fnSource"
            ]
          }
        },
        {
          "if": {
            "not": {
              "required": [
                "computeType"
              ]
            }
          },
          "then": {
            "required": [
              "value"
            ]
          }
        }
      ]
    },
    "booleanProperty": {
      "type": "object",
      "properties": {
        "value": {
          "type": "boolean",
          "description": "The simple value of a 'boolean' component property."
        }
      },
      "description": "boolean property type",
      "required": [
        "value"
      ]
    },
    "stringPropertyCalculable": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string",
          "description": "The simple value of a 'string' component property."
        },
        "fnSource": {
          "type": "string",
          "description": "Source code of the function for calculating the value of a 'itemRenderWhen' component property."
        },
        "computeType": {
          "type": "string",
          "enum": [
            "function"
          ],
          "description": "Type of the component's calculated property. If not specified - the value from value is used."
        }
      },
      "description": "string property type, calculable",
      "allOf": [
        {
          "if": {
            "properties": {
              "computeType": {
                "const": "function"
              }
            },
            "required": [
              "computeType"
            ]
          },
          "then": {
            "required": [
              "fnSource"
            ]
          }
        },
        {
          "if": {
            "not": {
              "required": [
                "computeType"
              ]
            }
          },
          "then": {
            "required": [
              "value"
            ]
          }
        }
      ]
    },
    "childrenProperty": {
      "type": "array",
      "items": {
        "anyOf": [
          {
            "$ref": "#/definitions/UploaderComponentStore"
          },
          {
            "$ref": "#/definitions/SlotComponentStore"
          },
          {
            "$ref": "#/definitions/EmbeddedFormComponentStore"
          },
          {
            "$ref": "#/definitions/RepeaterComponentStore"
          },
          {
            "$ref": "#/definitions/ModalComponentStore"
          }
        ]
      }
    }
  },
  "title": "FormEngine JSON schema"
}
